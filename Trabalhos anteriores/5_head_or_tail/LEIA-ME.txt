/* Trabalho de Transmissão de Dados - 2°/2014 - UnB */
/* João A. Ribeiro 			12/0014491 */
/* Pedro Paulo Struck Lima 	11/0073983 */

- Libnet usada: 1.1.x mais recente via sudo apt-get install libpnet-dev
- Libpcap usada: mais recente via sudo apt-get install libpcap-dev

l = libnet_init(LIBNET_RAW4, "lo", errbuf);

O cabeçalho Ethernet é construído automaticamente nessa aplicação (de forma transparente), e o dispositivo é o loopback "lo" em 127.0.0.1 (localhost).

Para compilar e executar:
compilar: gcc -Wall head_or_tail.c -o head_or_tail -lnet -lpcap
executar: sudo ./head_or_tail ["-S" para servidor ou "host" para cliente] ["nº da porta". Caso nula, porta = "22222"]

head_or_tail.c: código fonte
head_or_tail: executável. 
lnet e lpcap: ligar as duas bibliotecas

-----------------------------------------------------------------------
*** Breve explicação do programa ***

O programa é dividido nas seguintes funções:

envia_pacote: encapsula a mensagem, construindo os cabeçalhos UDP, IP e enviando o pacote com a LIBNET.

imprime_dados: depois que se desencapsula um pacote, os dados são passados para o buffer global do programa e este é impresso na tela.

processa_pacote: processa um pacote recebido a fim de se extrair os dados.

aguarda_pacote: Configura o dispositivo, a expressão de filtro e deixa no loop da pcap para escutar o que vier na porta.

gera, encripta e desencripta: Funções relacionadas a geração e o tratamento das chaves e da escolha. Essas estão ok.

Cliente: Modo cliente
Servidor: Modo servidor
Eu coloquei comentários numerados nessas duas funções para guiar a ordem da comunicação.
A ordem está de acordo com a especificação, então acho que não tem ninguém "atropelando" ninguém.

main: Escolhe o caminho de execução de acordo com o modo de operação escolhido na execução do programa e associa a porta lida no argv[2].
Caso seja nula, a porta padrao a ser usada é a 22222.

*** Dificuldades ***

- Somente conseguimos rodar o programa na máquina do João Vitor. Uma screenshot dessa tentativa bem sucedida está junta dos arquivos enviados.

No computador do Pedro não se conseguiu nenhuma vez enviar o hello do Cliente para o Servidor.

- O gerador, encriptador e decifrador foram testados em um programa a parte e estão funcionando corretamente, gerando sempre criptogramas de 4 bytes.

O arquivo é o decifrador_XOR.c e pode ser rodado com:
compilar: gcc -Wall decifrador_XOR.c -o decifrador
executar: ./decifrador

- Usamos o tutorial do link:
http://www.tcpdump.org/pcap.html

Pedimos ajuda aos colegas via grupo do facebook mas mesmo assim não obtivemos sucesso no envio/recebimento dos pacotes.





